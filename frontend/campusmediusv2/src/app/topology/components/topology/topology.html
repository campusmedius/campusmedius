<cm-map *ngIf="selectedMediator"
    [@mapTopOffset]="mediationState"
    [@mapLeftOffset]="sidepanelState"
    [overlayBottomSize]="!isMobile ? mediationsHeight : mobileOverlayHeight"
    [overlayRightSize]="!isMobile ? sidepanelWidth : '0px'"
    [overlayTopSize]="isMobile ? mediationsHeight : '0px'" >
    <cm-map-mediator *ngFor="let mediator of visibleMediators" [mediator]="mediator" [mediation]="selectedMediation" [lang]="translate.currentLang" [selected]="mediator === selectedMediator">
    </cm-map-mediator>
</cm-map>

<cm-sidepanel *ngIf="!isMobile" [@sidenav]="sidepanelState" [state]="sidepanelState" [showControl]="selectedMediator && selectedMediator.id !== '0'" (controlClick)="toggleInformationPanel()" >
    <div *ngIf="sidepanelState === 'full'" class="title-header" fxLayout="row" fxLayoutAlign=" center" [@titleHeader]="showTitleHeader">
        <button class="cite-button" [title]="translate.currentLang === 'de' ? 'Metadaten' : 'Metadata'" mat-icon-button (click)="showCite()">
            <span class="cm-square-quote-alt"></span>
        </button>
        <h1 [innerHtml]="translate.currentLang === 'de' ? selectedMediator.titleDe : selectedMediator.titleEn"></h1>
    </div>
    <div class="mediation-info">
        <span class="demand">{{translate.currentLang === 'de' ? selectedMediation.demandDe : selectedMediation.demandEn}}:&nbsp;</span>
        <span class="response">{{translate.currentLang === 'de' ? selectedMediation.responseDe : selectedMediation.responseEn}}</span>
    </div>
    <div class="up-header" [@titleHeader]="showTitleHeader">
        <button mat-icon-button class="back-to-top" (click)="scrollUp()">
            <span class="cm-back-to-top"></span>
        </button>
    </div>
    <div class="info-container">

        <cm-info-container *ngIf="selectedMediator; else startPage"
         [lang]="translate.currentLang"
         [title]="translate.currentLang === 'de' ? selectedMediator.titleDe : selectedMediator.titleEn"
         [subTitle]="translate.currentLang === 'de' ? selectedMediator.medium.titleDe.toUpperCase() : selectedMediator.medium.titleEn.toUpperCase()"
         [hideSubTitle]="selectedMediator.id === '0'"
         [state]="sidepanelState"
         [abstract]="translate.currentLang === 'de' ? selectedMediator.abstractDe : selectedMediator.abstractEn"
         [content]="translate.currentLang === 'de' ? information.contentDe : information.contentEn"
         [media]="information.media"
         (citeClick)="showCite()"
         [readMoreText]="translate.currentLang === 'de' ? 'WEITERLESEN' : 'READ MORE'"
         [hideReadMoreText]="selectedMediator.id === '0'"
         (moreClick)="toggleInformationPanel()"
         (sectionChange)="sectionChange($event)"
         (showTitleHeader)="showTitleHeader = $event">
        </cm-info-container>
        <ng-template #startPage>
            <cm-info-container
             [lang]="translate.currentLang"
             [title]="translate.currentLang === 'de' ? page.titleDe : page.titleEn"
             [abstract]="translate.currentLang === 'de' ? page.abstractDe : page.abstractEn"
             [readMoreText]="'START'"
             (moreClick)="readMore()">
            </cm-info-container>
        </ng-template>
    </div>
</cm-sidepanel>

<cm-info-box *ngIf="selectedMediator" [@infoBox]="mediationState"></cm-info-box>

<cm-mediations
    [@mediationsPanel]="sidepanelState"
    [mediations]="mediations"
    [selectedMediation]="selectedMediation || focusedMediation"
    [selectedMediator]="selectedMediator || focusedMediator"
    [sidepanelState]="sidepanelState"
    (height)="mediationsHeight = $event"
    (state)="mediationState = $event"
    (focusedMediation)="focusedMediation = $event"></cm-mediations>

<cm-start-selector
    *ngIf="!selectedMediator"
    [mediators]="mediators.slice(1,16)"
    [mediations]="mediations"
    [overlayBottomSize]="!isMobile ? mediationsHeight : mobileOverlayHeight"
    [overlayRightSize]="!isMobile ? sidepanelWidth : '0px'"
    [lang]="translate.currentLang"
    [selectedMediationId]="focusedMediation ? focusedMediation.id : null"
    (focusedMediation)="focusedMediation = $event"
    (focusedMediator)="focusedMediator = $event"></cm-start-selector>


<cm-god-selector
    *ngIf="atGod"
    [sidepanelStateForLinks]="sidepanelStateForLinksInGodSelector"
    [overlayBottomSize]="!isMobile ? mediationsHeight : mobileOverlayHeight"
    [overlayRightSize]="!isMobile ? sidepanelWidth : '0px'"
    [mediators]="mediators.slice(1,16)"></cm-god-selector>
